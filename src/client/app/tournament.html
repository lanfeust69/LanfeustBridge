<h2 class="text-center">Tournament {{_tournament ? _tournament.name : tournamentName}}</h2>
<p class="text-center" *ngIf="_tournament">Created on : {{_tournament.date.toLocaleDateString('en-US')}}</p>
<h3 class="text-center" *ngIf="_tournament && running">
    <span class="text-primary">Now Running</span>
</h3>
<!--<p class="text-center">{{diagnostic}}</p>-->
<div class="container" *ngIf="_tournament">
    <tabset>
        <tab heading='Infos'>
            <form (ngSubmit)="onSubmit()" #tournamentForm="ngForm">
                <fieldset *ngIf="true" [disabled]="!_edit">
                    <!-- *ngIf is a workaround for a known angular2 bug -->
                    <div class="form-group">
                        <label for="name">Name</label>
                        <input type="text" class="form-control" [(ngModel)]="_tournament.name"
                               placeholder="Tournament name" ngControl="name" required #name="ngForm">
                        <div [hidden]="name.valid" class="alert alert-danger">
                            Name is required
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="movement">Movement</label>
                        <select class="form-control" required [(ngModel)]="_tournament.movement">
                            <option *ngFor="let m of _knownMovements" [value]="m">{{m}}</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="tables">Number of tables</label>
                        <input type="number" class="form-control" [(ngModel)]="_tournament.nbTables" required>
                    </div>
                    <div class="form-group">
                        <label for="rounds">Number of rounds</label>
                        <input type="number" class="form-control" [(ngModel)]="_tournament.nbRounds" required>
                    </div>
                    <div class="form-group">
                        <label for="dealsPerRound">Number of deals per rounds</label>
                        <input type="number" class="form-control" [(ngModel)]="_tournament.nbDealsPerRound" required>
                    </div>
                </fieldset>
            </form>
        </tab>
        <tab heading="Play" *ngIf="running">
            <h4>Round {{_currentRound + 1}}</h4>
            <div class="form-group">
                <label for="player">Player</label>
                <select class="form-control" required [(ngModel)]="_currentPlayer">
                    <option *ngFor="let p of players; let i = index" [value]="i">{{p.name}}</option>
                </select>
            </div>
            <div class="form-group">
                <label for="deal">Deal</label>
                <select class="form-control" required [(ngModel)]="_currentDeal">
                    <option *ngFor="let d of roundDeals" [value]="d">#{{d}}</option>
                </select>
            </div>
            <score-form [(score)]="_currentScore" (validatedd)="scoreValidated()"></score-form>
            <button class="btn btn-primary" [disabled]="!roundFinished || _currentRound == _tournament.nbRounds - 1" (click)="nextRound()">Next Round</button>
        </tab>
        <tab heading="Players" *ngIf="_tournament.players">
            <div *ngIf="!_edit" class="list-group">
                <a [routerLink]="['Tournament', { id: _tournament.id }]" class="list-group-item"
                    *ngFor="let player of players; let i = index">Player {{i + 1}} : {{player.name}}</a>
                <!--<a [routerLink]="['User', { name: player?.name }]" class="list-group-item" *ngFor="let player of _tournament.players">{{player?.name}}</a>-->
            </div>
            <form *ngIf="_edit" class="list-group form-horizontal">
                <div *ngFor="let player of players; let i = index" class="form-group list-group-item">
                    <label for="player" class="control-label col-xs-2">Player {{i + 1}}</label>
                    <div class="col-xs-10">
                    <input type="text" class="form-control" [(ngModel)]="player.name" placeholder="Player name">
                    </div>
                </div>
            </form>
        </tab>
        <tab heading="Deals" *ngIf="finished && nbDeals">
            <div class="list-group">
                <a [routerLink]="['Deal', { tournamentId: _tournament.id, dealId: deal.id }]" class="list-group-item" *ngFor="let deal of deals">Deal {{deal.id}}</a>
            </div>
        </tab>
    </tabset>
    <div [hidden]="!_edit || isValid" class="alert alert-danger">
        {{_invalidReason}}
    </div>
    <button *ngIf="_edit" class="btn btn-primary" [disabled]="!tournamentForm.form.valid || !isValid" (click)="onSubmit()">{{_created ? "Update" : "Create"}}</button>
    <button *ngIf="setup && _created && !_edit" class="btn btn-primary" (click)="_edit = !_edit">Edit</button>
    <button *ngIf="setup && _created && !_edit" class="btn btn-primary" (click)="start()">Start</button>
    <!--<button *ngIf="running" class="btn btn-primary" (click)="play()">Play</button>-->
    <button *ngIf="running" class="btn btn-primary" (click)="close()">Close</button>
    <a [routerLink]="['TournamentList']">Back</a>
</div>
